<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Mi Chat</title>
  <style>
    body { margin:0; font-family:sans-serif; }
    #chat { width:360px; height:600px; border:2px solid #226622; position:fixed; right:20px; bottom:20px; display:flex; flex-direction:column; }
    #msgs { flex:1; overflow-y:auto; padding:8px; background:#f7fff7; }
    .msg { margin:4px; padding:8px; border-radius:8px; max-width:80%; }
    .user { background:#4caf50; color:#fff; align-self:flex-end; }
    .bot  { background:#c8e6c9; color:#2e7d32; align-self:flex-start;}
    #input { border-top:1px solid #226622; display:flex; }
    #input input { flex:1; border:none; padding:8px; }
    #input button { border:none; background:#226622; color:#fff; padding:8px 16px; }
  </style>
</head>
<body>
  <div id="chat">
    <div id="msgs"></div>
    <div id="input">
      <input id="text" placeholder="Escribe..." />
      <button onclick="send()">Enviar</button>
    </div>
  </div>

  <script>
    async function send(){
      const t = document.getElementById('text');
      const txt = t.value.trim();
      if(!txt) return;
      const msgs = document.getElementById('msgs');
      const u = document.createElement('div'); u.className='msg user'; u.innerText=txt; msgs.appendChild(u);
      t.value=''; msgs.scrollTop=msgs.scrollHeight;
      try{
        const r = await fetch('/dialogflow',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({message:txt})
        });
        const j = await r.json();
        const b = document.createElement('div'); b.className='msg bot';
        b.innerText = j.reply || 'Lo siento, no entend√≠ eso.';
        msgs.appendChild(b);
        msgs.scrollTop=msgs.scrollHeight;
      }catch(e){
        console.error(e);
      }
    }
  </script>
</body>
</html>
